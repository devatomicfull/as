= Projeto Android CameraX - Guia Completo

v1.0, Julho 2025

:toc: left
:toclevels: 3
:icons: font
:source-highlighter: highlightjs

== üìë Sum√°rio Geral

[cols="1,1"]
|===
| *T√≥pico* | *Subt√≥pico / Link*

| 1. CameraX
| - <<app1, App1: Captura com Preview>>

| 2. Camera1
| - <<app2, App2: Captura B√°sica>>
|===


== API - CameraX : Utiliza√ß√£o da API Jetpack para melhor desempenho e evitar Erros 

üì¶ Pacotes Importantes

Os projetos que fazem o uso da camerax podem ter das seguintes bibliotecas e pacotes:

androidx
- `camera.core`
- `camera.lifecycle`
- `camera.view`
- `activity.result`
- 'core.content`

java
- `util.concurrent`

android
- `os`
- `content`
- `Manifest`
- `widget`

Classes Usadas no projeto da camerax

|===
| Classe | Fun√ß√£o

| `PreviewView`
| Componente visual para exibir a c√¢mera no layout.

| `ActivityResultLauncher<I>`
| Abstra√ß√£o moderna para solicitar permiss√µes ou resultados de atividades.

| `ActivityResultContracts`
| Contratos prontos para uso com `ActivityResultLauncher`, como `RequestPermission`.

| `ContextCompat`
| Verifica√ß√£o de permiss√µes de forma compat√≠vel com vers√µes anteriores do Android.

| `PackageManager`
| Usado para verificar se a permiss√£o foi concedida.

| `Manifest`
| Cont√©m constantes como `Manifest.permission.CAMERA`.

| `File`
| Representa o arquivo de imagem salvo localmente.

| `ImageCapture`
| Caso de uso da API CameraX para capturar imagens.

| `ImageCapture.OnImageSavedCallback`
| Interface de callback para sucesso ou erro durante salvamento da imagem.

| `LifecycleOwner`
| Interface implementada por `Activity`/`Fragment` para suportar binding da c√¢mera ao ciclo de vida.

| `Context`
| Contexto da aplica√ß√£o, necess√°rio para instanciar diversos componentes Android.

| `ExecutorService`
| Executor de thread √∫nica utilizado para rodar opera√ß√µes da c√¢mera em segundo plano.

| `LifecycleCameraController`
| Controlador simplificado da c√¢mera baseado em ciclo de vida, fornece suporte integrado ao preview e captura.

| `CameraSelector`
| Permite escolher qual c√¢mera utilizar (frontal, traseira).
|===

== üìö Apps que usam CameraX

[[app1]]
=== App1: Captura com Preview

Este projeto utiliza a API moderna *CameraX* do Android Jetpack para capturar imagens, com integra√ß√£o ao ciclo de vida, preview e armazenamento local do app.

Exemplo pr√°tico de captura de imagem usando `PreviewView` e `ImageCapture`.

---

[cols="1a", options="header"]
|===
| Interface do App

| image::camerax_img/app1.png[width=300, alt="Preview da c√¢mera"]
|===

== üìñ Descri√ß√£o Geral do Projeto

Este aplicativo demonstra o uso b√°sico da API CameraX para capturar fotos, exibindo a visualiza√ß√£o da c√¢mera diretamente na interface por meio do `PreviewView`. Tamb√©m utiliza `ActivityResultLauncher` para solicitar permiss√µes de forma moderna e segura.

=== Usa o CameraController

Fornece a maioria das funcionalidades principais do *CameraX* em uma √∫nica classe:

- Requer c√≥digo de configura√ß√£o
- Processa automaticamente a inicializa√ß√£o da c√¢mera
- Gerencia os *casos de uso* (Use Cases)

==== O que √© um "caso de uso (Use Case)" no CameraX?

No contexto do *CameraX*, um **caso de uso** √© um tipo espec√≠fico de tarefa que voc√™ deseja que a c√¢mera realize. Por exemplo:

[cols="1,3", options="header"]
|===
| Caso de Uso (Classe) | Fun√ß√£o

| `Preview`
| Mostra a imagem da c√¢mera na tela (visualiza√ß√£o em tempo real)

| `ImageCapture`
| Captura de imagens est√°ticas (fotos)

| `VideoCapture`
| Grava√ß√£o de v√≠deos

| `ImageAnalysis`
| Processamento em tempo real dos frames da c√¢mera (ex: leitura de QR Code, uso com ML (Machine Learning), etc.)

| Extensions     
| HDR, modo retrato, noturno (se suportado)

|===


=== ‚öôÔ∏è Componentes principais

- Interface visual com bot√£o de captura.
- Controle da c√¢mera encapsulado via classe `CameraHelper`.
- Salvamento de imagens em diret√≥rio interno do app.
- Toasts para feedback de sucesso ou falha.
- Gerenciamento adequado de ciclo de vida.

=== üìÇ Nome do App

[source,java]
----
‚îú‚îÄ‚îÄ cameraxsample
----

== ‚úÖ Regras e Requisitos para Funcionamento

=== Regra 1 - Permiss√£o de c√¢mera
A permiss√£o `Manifest.permission.CAMERA` deve ser concedida pelo usu√°rio em tempo de execu√ß√£o, ou a c√¢mera n√£o ser√° iniciada.

=== Regra 2 - Uso do ciclo de vida
A c√¢mera s√≥ ser√° iniciada quando a `Activity` ou `Fragment` for um `LifecycleOwner`, garantindo que o CameraX respeite os eventos como `onCreate`, `onDestroy`, etc.

=== Regra 3 - Diret√≥rio de armazenamento
As imagens s√£o salvas em:  
`getExternalFilesDir(null)`  
Este diret√≥rio √© privado do app e n√£o requer permiss√£o de armazenamento.

=== Regra 4 - Encerramento correto do executor
Para evitar vazamentos de mem√≥ria (memory leaks), o m√©todo `cameraHelper.encerrar()` deve ser chamado no `onDestroy()` da `Activity`.

=== Regra 5 - Interface responsiva
As intera√ß√µes com a UI ap√≥s a captura (exibi√ß√£o de `Toast`, etc.) devem sempre ser feitas com `runOnUiThread()` para manter a estabilidade da interface.

== üîê Permiss√µes no AndroidManifest.xml

Para que a aplica√ß√£o funcione corretamente com a c√¢mera e possa salvar imagens, √© necess√°rio declarar permiss√µes no `AndroidManifest.xml`.

=== üìÑ Permiss√µes utilizadas:

TAGS utilizadas:
`<uses-permission android:name="..."/>`

[source,xml]
----
<!-- Permiss√£o para usar a c√¢mera -->
<uses-permission android:name="android.permission.CAMERA"/>

<!-- Permiss√£o para gravar arquivos em armazenamento externo
     OBS: Necess√°rio apenas para Android 9 (API 28) ou inferior,
     pois a partir do Android 10 (API 29), o acesso direto ao armazenamento
     externo foi restringido (Scoped Storage). -->
<uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE"/>
----

=== ‚ÑπÔ∏è Observa√ß√µes:

- A permiss√£o `CAMERA` √© **obrigat√≥ria** para qualquer uso da API CameraX.
- A permiss√£o `WRITE_EXTERNAL_STORAGE` **n√£o √© mais recomendada em Android 10+**.
  Use `getExternalFilesDir()` para salvar imagens dentro do sandbox do app, sem precisar da permiss√£o.
- A partir do Android 6 (API 23), voc√™ tamb√©m precisa **solicitar essas permiss√µes em tempo de execu√ß√£o** (runtime).
- link:https://developer.android.com/training/permissions/requesting?hl=pt-br[Documenta√ß√£o Oficial - Solicitar permiss√µes de execu√ß√£o]


== üõ†Ô∏è Requisitos T√©cnicos - M√≠nimos

- SDK m√≠nimo: **API 21 (Lollipop)**
- Android Architecture Components: **v1.1.1 ou superior**
- Gradle Plugin: **8.0+**
- Permiss√µes declaradas no `AndroidManifest.xml` via tag `<uses-permission />`

=== üîÑ Ciclo de Vida (Lifecycle)

Para atividades que envolvam ciclo de vida com CameraX, utilize as seguintes classes base:

- link:https://developer.android.com/reference/androidx/fragment/app/FragmentActivity[üìò FragmentActivity - Documenta√ß√£o Oficial]
- link:https://developer.android.com/reference/androidx/appcompat/app/AppCompatActivity[üìò AppCompatActivity - Documenta√ß√£o Oficial]

== üì¶ Gradle Scripts

=== Depend√™ncias no `settings.gradle.kts` (n√≠vel do projeto `setttings`)

Para utilizar a *API CameraX*, √© necess√°rio garantir que o projeto esteja configurado com os reposit√≥rios corretos para resolver as depend√™ncias.

Essa configura√ß√£o √© feita no arquivo `settings.gradle.kts`, adicionando o reposit√≥rio do Google e Maven Central.

- Adiciona o reposit√≥rio `google()` (obrigat√≥rio para CameraX)
- Inclui tamb√©m o `mavenCentral()` para garantir compatibilidade com outras bibliotecas

[source,kotlin]
----
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()        // Necess√°rio para CameraX e bibliotecas do Jetpack
        mavenCentral()  // Reposit√≥rio adicional para outras depend√™ncias
    }
}
----

Adicione o c√≥digo abaixo ao fim do bloco `android{ ... }`: 

[source, kotlin]
----
android {
 // No final
    compileOptions {
        // sourceCompatibility = JavaVersion.VERSION_1_8
        // targetCompatibility = JavaVersion.VERSION_1_8

        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    // For Kotlin projects
    kotlinOptions {
        jvmTarget = "1.8"
    }
}
----

=== Depend√™ncias no `build.gradle.kts` (n√≠vel do m√≥dulo `:app`)

Adicione o c√≥digo a seguir ao arquivo build.gradle.kts de cada m√≥dulo para um app
Abaixo est√£o as depend√™ncias necess√°rias para utilizar a API CameraX com suas funcionalidades principais.

[source,kotlin]
----
dependencies {
    // Vers√£o da CameraX utilizada
    val cameraxVersion = "1.5.0-beta01"

    // === CameraX ===

    // camera-core: Fornece as interfaces e classes base da CameraX,
    // como CameraController, UseCase, LifecycleCamera, etc.
    implementation("androidx.camera:camera-core:$cameraxVersion")

    // camera-camera2: Fornece a implementa√ß√£o baseada na API Camera2.
    // √â a backend real que se comunica com o hardware da c√¢mera.
    implementation("androidx.camera:camera-camera2:$cameraxVersion")

    // camera-lifecycle: Permite que os casos de uso (preview, captura) se liguem automaticamente
    // ao ciclo de vida de uma Activity ou Fragment (LifecycleOwner).
    implementation("androidx.camera:camera-lifecycle:$cameraxVersion")

    // camera-video: (Opcional) Adiciona suporte para grava√ß√£o de v√≠deos com CameraX.
    // Habilita o caso de uso VideoCapture, ideal para capturar v√≠deos diretamente da c√¢mera.
    implementation("androidx.camera:camera-video:$cameraxVersion")

    // camera-view: Fornece o PreviewView, que √© o componente visual para exibir o v√≠deo da c√¢mera.
    // Tamb√©m suporta gestos, zoom, foco por toque etc.
    implementation("androidx.camera:camera-view:$cameraxVersion")

     // camera-mlkit-vision: (Opcional) Integra√ß√£o com ML Kit Vision
     // Permite aplicar modelos de Machine Learning diretamente nos frames da c√¢mera,
     // como detec√ß√£o de rostos, OCR, leitura de QR codes, etc.
     implementation("androidx.camera:camera-mlkit-vision:$cameraxVersion")

    // camera-extensions: Habilita recursos espec√≠ficos do fabricante,
    // como modo retrato, HDR, modo noturno, beauty mode etc. (se o dispositivo suportar).
    implementation("androidx.camera:camera-extensions:$cameraxVersion")
}
----

== ‚ÑπÔ∏è Observa√ß√£o

- Para ter mais informa√ß√µes sobre como configurar seu app para atender a esses requisitos
- link:https://developer.android.com/jetpack/androidx/releases/lifecycle?hl=pt-br#declaring_dependencies[Declarar depend√™ncias]

A depend√™ncia `camera-mlkit-vision` **n√£o inclui os modelos do ML Kit embutidos**.  
Ela apenas cria o elo entre o *CameraX* e os modelos do *ML Kit Vision*.

Para que o reconhecimento funcione (ex: rostos, textos, c√≥digos), √© necess√°rio importar manualmente os m√≥dulos espec√≠ficos desejados do ML Kit.

=== üì¶ Bibliotecas necess√°rias (exemplos):

[source,kotlin]
----
implementation("com.google.mlkit:barcode-scanning:17.0.2")       // Leitura de QR Codes e c√≥digos de barras
implementation("com.google.mlkit:text-recognition:16.0.0")       // Reconhecimento √≥ptico de caracteres (OCR)
implementation("com.google.mlkit:face-detection:16.1.5")         // Detec√ß√£o de rostos
----

Caso tenha d√∫vidas ou queira contribuir, envie uma mensagem ou abra um pull request.

